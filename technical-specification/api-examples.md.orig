# Practical Examples

## Get Data linked to Connected Users

* No specification for url syntax
* Requests have to fill Authorization Header with JWT OIDC Token obtained thanks to login.lescommuns.org application.
* Basic authentification
  * Server has to validate token thanks to signature and parse token to obtain preferred\_username.
  * This preferred\_username can be linked to the Platform User. To link OIDC User and Platform User, platforms can add OIDC authentification feature.
* Outdated Token
  * If token is outdated, platforms can refuse request.
  * If platforms have to request another \(DFC or Other\) and receive outaded input token, Platforms can remember refresh token \(when OIDC authentication features execution\) and ask new access with a specific request.

### version 1.4
#### version 1.3 upgrade
* préfix différent selon la partie de l'ontologie importée
* rdfs:label replace by dfc-b description in CutomerCatgory
* unité issue du referenceiel
* contexte plus explicite sur le type @id pour dimplifier les datas

#### example
```json
{
  "@context": {
    "dfc-b": "http://datafoodconsortium.org/ontologies/dfc_FullModel.owl#",
    "dfc-p": "http://datafoodconsortium.org/ontologies/dfc_ProductGlossary.owl#",
    "dfc-b:hasUnit":{
      "@type":"@id"
    },
    "dfc-b:references":{
      "@type":"@id"
    },
    "dfc-b:offeresTo":{
      "@type":"@id"
    },
    "@base": "http://maPlateformeNationale"
  },
  "@id": "/personId",
  "@type": "dfc-b:Person",
  "dfc-b:familyName": "Doe",
  "dfc-b:firtsName": "Jhon",
  "dfc-b:hasAdress": {
    "@type": "dfc-b:Address",
    "dfc-b:city": "",
    "dfc-b:country": "",
    "dfc-b:postcode": "",
    "dfc-b:street": ""
  },
  "dfc-b:affiliates": [
    {
      "@id": "/entrepriseId",
      "@type": "dfc-b:Entreprise",
      "dfc-b:VATnumber": "",
      "dfc-b:defines": [
        {
          "@id": "/customerCategoryId1",
          "@type": "dfc-b:CustomerCategory",
          "dfc-b:description": "member"
        },
        {
          "@id": "/customerCategoryId2",
          "@type": "dfc-b:CustomerCategory",
          "dfc-b:description": "non member"
        }
      ],
      "dfc-b:supplies": [
        {
          "@id": "/suppliedProduct/item3",
          "dfc-b:hasUnit": "dfc-p:u",
          "dfc-b:quantity": "99.99",
          "dfc-b:description": "supply description 1",
          "dfc-b:totalTheoriticalStock": "999",
          "dfc-b:brand": "supply brand",
          "dfc-b:claim": "supply claim",
          "dfc-b:image": "supply image url",
          "dfc-b:lifeTime": "supply lifeTime",
          "dfc-b:physicalCharacterisctics": "supply physical characterisctics"
        },
        {
          "@id": "/suppliedProduct/item4",
          "dfc-b:hasUnit": "dfc-p:u",
          "dfc-b:quantity": "1",
          "dfc-b:description": "supply description 2",
          "dfc-b:totalTheoriticalStock": "999",
          "dfc-b:brand": "supply brand",
          "dfc-b:claim": "supply claim",
          "dfc-b:image": "supply image url",
          "dfc-b:lifeTime": "supply lifeTime",
          "dfc-b:physicalCharacterisctics": "supply physical characterisctics"
        }
      ],
      "dfc-b:manages": [
        {
          "@id": "/catalogItemId1",
          "@type": "dfc-b:CatalogItem",
          "dfc-b:references": "/suppliedProduct/item3",
          "dfc-b:sku": "catalog item gtin or sku",
          "dfc-b:stockLimitation": "999",
          "dfc-b:offeredThrough": [
            {
              "@id": "offerId1",
              "@type": "dfc-b:Offer",
              "dfc-b:offeresTo": "/customerCategoryId1",
              "dfc-b:price": "0",
              "dfc-b:stockLimitation": "999"
            },
            {
              "@id": "offerId2",
              "@type": "dfc-b:Offer",
              "dfc-b:offeresTo": "/customerCategoryId2",
              "dfc-b:price": "999",
              "dfc-b:stockLimitation": "999"
            }
          ]
        },
        {
          "@id": "/catalogItemId2",
          "@type": "dfc-b:CatalogItem",
          "dfc-b:sku": "catalog item gtin or sku",
          "dfc-b:stockLimitation": "999",
          "dfc-b:references": "/suppliedProduct/item4",
          "dfc-b:offeredThrough": [
            {
              "@id": "offerId3",
              "@type": "dfc-b:Offer",
              "dfc-b:offeresTo": "/customerCategoryId1",
              "dfc-b:price": "000",
              "dfc-b:stockLimitation": "999"
            },
            {
              "@id": "offerId4",
              "@type": "dfc-b:Offer",
              "dfc-b:offeresTo": "/customerCategoryId2",
              "dfc-b:price": "999",
              "dfc-b:stockLimitation": "999"
            }
          ]
        }
      ]
    }
  ]
}
```

### version 1.3

#### version 1.2 upgrade

We made the following changes from version 1.2:

* Support multiple enterprises for logged-in user
  * In fact, we recentered the data graph root on user
* Use the catalog item
  * The Catalog Item allows us to list all the Defined Products \(Supplied et Tecnical\) on a uniq entreprise.
  * It is possible to add an extra layer between Catalog Item and Entreprise called Repository. It can be used to break down the general catalog into multiple ones.
* Add offers that are linked to the catalog item

### Example

```javascript
{
  "@context": {
    "dfc": "http://datafoodconsortium.org/ontologies/dfc_FullModel.owl#",
    "@base": "http://maPlateformeNationale"
  },
  "@id": "/personId",
  "@type": "dfc:Person",
  "dfc:familyName": "Doe",
  "dfc:firtsName": "Jhon",
  "dfc:hasAdress": {
    "@type": "dfc:Address",
    "dfc:city": "",
    "dfc:country": "",
    "dfc:postcode": "",
    "dfc:street": ""
  },
  "dfc:affiliates": [
    {
      "@id": "/entrepriseId",
      "@type": "dfc:Entreprise",
      "dfc:VATnumber": "",
      "dfc:defines": [
        {
          "@id": "/customerCategoryId1",
          "@type": "dfc:CustomerCategory",
          "rdfs:label": "member"
        },
        {
          "@id": "/customerCategoryId2",
          "@type": "dfc:CustomerCategory",
          "rdfs:label": "non member"
        }
      ],
      "dfc:supplies": [
        {
          "@id": "/suppliedProduct/item3",
          "dfc:hasUnit": {
            "@id": "/unit/kg",
            "rdfs:label": "kilogram"
          },
<<<<<<< HEAD
          "dfc:quantity": "99.99",
          "dfc:description": "supply description 1",
          "dfc:totalTheoriticalStock": "999",
          "dfc:brand": "supply brand",
          "dfc:claim": "supply claim",
          "dfc:image": "supply image url",
          "lifeTime": "supply lifeTime",
          "dfc:physicalCharacterisctics": "supply physical characterisctics"
=======
          "dfc:quantity":"99.99",
          "dfc:description":"supply description 1",
          "dfc:totalTheoriticalStock":"999",
          "dfc:brand":"supply brand",
          "dfc:claim":"supply claim",
          "dfc:image":"supply image url",
          "lifeTime":"supply lifeTime",
          "dfc:physicalCharacterisctics":"supply physical characterisctics"
>>>>>>> 1106fc53f8e5950e4b15053a5d0cd23bb3ea4de7
        },
        {
          "@id": "/suppliedProduct/item4",
          "dfc:hasUnit": {
            "@id": "/unit/unit",
            "rdfs:label": "unit"
          },
          "dfc:quantity": "1",
          "dfc:description": "supply description 2",
          "dfc:totalTheoriticalStock": "999",
          "dfc:brand": "supply brand",
          "dfc:claim": "supply claim",
          "dfc:image": "supply image url",
          "lifeTime": "supply lifeTime",
          "dfc:physicalCharacterisctics": "supply physical characterisctics"
        }
      ],
      "dfc:manages": [
        {
          "@id": "/catalogItemId1",
          "@type": "dfc:CatalogItem",
          "dfc:references": {
            "@type": "@id",
            "@id": "/suppliedProduct/item3"
          },
          "dfc:sku": "catalog item gtin or sku",
          "dfc:stockLimitation": "999",
          "dfc:offeredThrough": [
            {
              "@id": "offerId1",
              "@type": "dfc:Offer",
              "dfc:offeresTo": {
                "@type": "@id",
                "@id": "/customerCategoryId1"
              },
              "dfc:price": "0",
              "dfc:stockLimitation": "999"
            },
            {
              "@id": "offerId2",
              "@type": "dfc:Offer",
              "dfc:offeresTo": {
                "@type": "@id",
                "@id": "/customerCategoryId2"
              },
              "dfc:price": "999",
              "dfc:stockLimitation": "999"
            }
          ]
        },
        {
          "@id": "/catalogItemId2",
          "@type": "dfc:CatalogItem",
          "dfc:sku": "catalog item gtin or sku",
          "dfc:stockLimitation": "999",
          "dfc:references": {
            "@type": "@id",
            "@id": "/suppliedProduct/item4"
          },
          "dfc:offeredThrough": [
            {
              "@id": "offerId3",
              "@type": "dfc:Offer",
              "dfc:offeresTo": {
                "@type": "@id",
                "@id": "/customerCategoryId1"
              },
              "dfc:price": "000",
              "dfc:stockLimitation": "999"
            },
            {
              "@id": "offerId4",
              "@type": "dfc:Offer",
              "dfc:offeresTo": {
                "@type": "@id",
                "@id": "/customerCategoryId2"
              },
              "dfc:price": "999",
              "dfc:stockLimitation": "999"
            }
          ]
        }
      ]
    }
  ]
}
```

### version 1.2

In version 1.2 we had only one enterprise per logged in user:

```javascript
{
  "@context": {
    "dfc": "http://datafoodconsortium.org/ontologies/dfc_FullModel.owl#",
    "@base": "http://maPlateformeNationale"
  },
  "@id": "/entreprise/maGrandeEntreprise",
  "@type": "dfc:Entreprise",
  "dfc:supplies":[
    {
      "@id":"/suppliedProduct/item3",
      "dfc:hasUnit":{
        "@id":"/unit/kg"
      },
      "dfc:quantity":"0,5",
      "dfc:description":"Aillet botte 1 pièce"
    },
    {
      "@id":"/suppliedProduct/item4",
      "dfc:hasUnit":{
        "@id":"/unit/unit"
      },
      "dfc:quantity":"1",
      "dfc:description":"Aromates-Romarin Botte 1 pièce"
    }
  ]
}
```

